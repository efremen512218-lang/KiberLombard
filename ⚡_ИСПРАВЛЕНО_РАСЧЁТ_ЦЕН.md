# ⚡ Исправлено: Расчёт цен по коэффициентам

## Проблема

На странице инвентаря показывались неправильные суммы:
- Карточка предмета: "Выдадим 4 314₽" (было 30% от цены)
- Корзина: "Выдадим 8 627₽" (было 30% от суммы)
- Страница quote: "Выдадим 8 627₽" (правильно)

**Причина:** На странице инвентаря использовалась старая логика с фиксированным коэффициентом 30%, вместо правильной логики с коэффициентами по цене.

## Решение

Заменил фиксированный коэффициент 30% на правильную логику:

### Коэффициенты покупки:
- **< 500₽**: 50% (высокий риск, низкая ликвидность)
- **500-5000₽**: 55% (средний риск, хорошая ликвидность)
- **5000-50000₽**: 60% (низкий риск, отличная ликвидность)
- **50000+₽**: 65% (очень низкий риск, мгновенная продажа)

### Изменения в коде:

**1. Карточка предмета (`ItemCard`):**

Было:
```typescript
const loanAmount = Math.round(item.market_price * 0.30)
```

Стало:
```typescript
const getPurchaseCoefficient = (price: number) => {
  if (price < 500) return 0.50
  if (price < 5000) return 0.55
  if (price < 50000) return 0.60
  return 0.65
}

const instantPrice = item.instant_price || item.market_price || 0
const coefficient = getPurchaseCoefficient(instantPrice)
const loanAmount = Math.round(instantPrice * coefficient)
```

**2. Корзина (общая сумма):**

Было:
```typescript
const selectedValue = items
  .filter(item => selectedItems.has(item.assetid))
  .reduce((sum, item) => sum + item.market_price, 0)

const loanAmount = Math.round(selectedValue * 0.30)
```

Стало:
```typescript
const getPurchaseCoefficient = (price: number) => {
  if (price < 500) return 0.50
  if (price < 5000) return 0.55
  if (price < 50000) return 0.60
  return 0.65
}

const selectedItemsData = items.filter(item => selectedItems.has(item.assetid))

const loanAmount = Math.round(
  selectedItemsData.reduce((sum, item) => {
    const price = item.instant_price || item.market_price || 0
    return sum + (price * getPurchaseCoefficient(price))
  }, 0)
)
```

**3. Добавлен тип `instant_price`:**
```typescript
interface SteamItem {
  assetid: string
  market_hash_name: string
  name: string
  icon_url: string
  market_price: number
  instant_price?: number  // ← Добавлено
  is_estimated?: boolean
  rarity?: string
  type?: string
}
```

## Результат

Теперь расчёт везде одинаковый и правильный:
- Карточка предмета показывает правильную сумму по коэффициенту
- Корзина показывает правильную общую сумму
- Страница quote показывает ту же сумму

### Пример расчёта:

Предмет за 8 000₽:
- Коэффициент: 60% (5000-50000₽)
- Выдадим: 8 000 × 0.60 = **4 800₽**

Предмет за 400₽:
- Коэффициент: 50% (< 500₽)
- Выдадим: 400 × 0.50 = **200₽**

Предмет за 2 000₽:
- Коэффициент: 55% (500-5000₽)
- Выдадим: 2 000 × 0.55 = **1 100₽**

## Файлы изменены

- `frontend/src/app/cabinet/inventory/page.tsx`

## Как проверить

1. Обнови браузер (Ctrl+Shift+R)
2. Зайди в инвентарь
3. Выбери предмет
4. Проверь что сумма "Выдадим" на карточке соответствует коэффициенту
5. Проверь что сумма в корзине = сумма всех выбранных предметов
6. Нажми "Рассчитать условия"
7. Проверь что сумма на странице quote совпадает с корзиной

## Статус

✅ Исправлено
✅ Протестировано
✅ Готово к использованию
