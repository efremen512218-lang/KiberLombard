# –°—Ç–∞—Ç—É—Å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ Production –≤–µ—Ä—Å–∏–∏

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ

### –§–∞–∑–∞ 1: –¶–µ–Ω—ã –∏ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å
- ‚úÖ –°–æ–∑–¥–∞–Ω `market_csgo_service.py` - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å market.csgo
- ‚úÖ –û–±–Ω–æ–≤–ª—ë–Ω `lisskins_service.py` - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Lis-Skins
- ‚úÖ –°–æ–∑–¥–∞–Ω `price_aggregator.py` - –∞–≥—Ä–µ–≥–∞—Ü–∏—è —Ü–µ–Ω –∏–∑ –≤—Å–µ—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
- ‚úÖ –°–æ–∑–¥–∞–Ω `steam_prices.py` - —Å–ø—Ä–∞–≤–æ—á–Ω—ã–µ —Ü–µ–Ω—ã Steam Market
- ‚úÖ –õ–æ–≥–∏–∫–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏: —Ç–æ–ª—å–∫–æ –ø—Ä–µ–¥–º–µ—Ç—ã —Å Lis-Skins —Ü–µ–Ω–æ–π >= 20‚ÇΩ
- ‚úÖ –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ü–µ–Ω –Ω–∞ 1 —á–∞—Å
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ API —Å fallback

### –§–∞–∑–∞ 2: –§–æ—Ä–º—É–ª—ã –∏ —Å—Ä–æ–∫–∏
- ‚úÖ –û–±–Ω–æ–≤–ª—ë–Ω `config.py` —Å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ–º—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏:
  - –ü–æ—Ä–æ–≥–∏ –ø—Ä–æ—Ü–µ–Ω—Ç–æ–≤ –≤—ã–¥–∞—á–∏ (500‚ÇΩ/5000‚ÇΩ/inf)
  - –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å—Ä–æ–∫–æ–≤ 7-30 –¥–Ω–µ–π
  - –ü—Ä–æ—Ü–µ–Ω—Ç—ã –∏ –ø—Ä–µ–º–∏–∏ –ø–æ —Å—Ä–æ–∫–∞–º
- ‚úÖ –°–æ–∑–¥–∞–Ω `pricing_service.py` —Å –Ω–æ–≤—ã–º–∏ —Ñ–æ—Ä–º—É–ª–∞–º–∏:
  - `get_loan_percent()` - –ø—Ä–æ—Ü–µ–Ω—Ç –≤—ã–¥–∞—á–∏ –ø–æ —Ü–µ–Ω–µ
  - `get_term_config()` - –∫–æ–Ω—Ñ–∏–≥ —Å—Ä–æ–∫–∞ —Å –∏–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏–µ–π
  - `calculate_quote()` - –ø–æ–ª–Ω—ã–π —Ä–∞—Å—á—ë—Ç —Å–¥–µ–ª–∫–∏

### –§–∞–∑–∞ 3: KYC
- ‚úÖ –°–æ–∑–¥–∞–Ω `sms_service.py`:
  - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤: fake, sms.ru, smsc.ru
  - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏ —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–æ–≤
  - –û—Ç–ø—Ä–∞–≤–∫–∞ SMS –¥–ª—è –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∏ –ø–æ–¥–ø–∏—Å–∏
- ‚úÖ –°–æ–∑–¥–∞–Ω `kyc_service.py`:
  - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤: fake, sumsub
  - –û—Ç–ø—Ä–∞–≤–∫–∞ –ø–∞—Å–ø–æ—Ä—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
  - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ (pending/passed/failed)

### –§–∞–∑–∞ 4: –î–æ–≥–æ–≤–æ—Ä –∏ –ø–æ–¥–ø–∏—Å—å
- ‚úÖ –°–æ–∑–¥–∞–Ω `contract_service.py`:
  - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è HTML –¥–æ–≥–æ–≤–æ—Ä–∞
  - –†–∞—Å—á—ë—Ç —Ö–µ—à–∞ –¥–æ–≥–æ–≤–æ—Ä–∞ (SHA-256)
  - –ú–∞—Å–∫–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –∏ IP
  - –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ PDF

### –§–∞–∑–∞ 5: –í—ã–ø–ª–∞—Ç—ã
- ‚úÖ –°–æ–∑–¥–∞–Ω `sbp_service.py`:
  - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤: fake, modulbank
  - –°–æ–∑–¥–∞–Ω–∏–µ –≤—ã–ø–ª–∞—Ç
  - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–æ–≤
  - –í–∞–ª–∏–¥–∞—Ü–∏—è –ª–∏–º–∏—Ç–æ–≤

---

## üîÑ –¢—Ä–µ–±—É–µ—Ç—Å—è –¥–æ—Ä–∞–±–æ—Ç–∫–∞

### Backend

#### 1. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ models.py
–ù—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ –º–æ–¥–µ–ª–∏:
```python
class KYCVerification(Base):
    """–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞—Å–ø–æ—Ä—Ç–∞"""
    id, user_id, verification_id, status, data, created_at

class DealSignature(Base):
    """–≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞—è –ø–æ–¥–ø–∏—Å—å"""
    id, deal_id, user_id, phone, signature_code_hash,
    signature_timestamp, ip_address, user_agent,
    contract_hash, contract_version

class AuditLog(Base):
    """–õ–æ–≥–∏ –¥–ª—è —Å—É–¥–∞"""
    id, deal_id, user_id, action, timestamp,
    ip_address, user_agent, session_id, details (JSON)

class SBPPayout(Base):
    """–í—ã–ø–ª–∞—Ç—ã –°–ë–ü"""
    id, deal_id, payout_id, phone, amount, status,
    created_at, updated_at, provider_response (JSON)
```

#### 2. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ main.py
–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ endpoints:
- `POST /api/kyc/phone/send` - –æ—Ç–ø—Ä–∞–≤–∫–∞ SMS
- `POST /api/kyc/phone/verify` - –ø—Ä–æ–≤–µ—Ä–∫–∞ SMS
- `POST /api/kyc/passport/submit` - –æ—Ç–ø—Ä–∞–≤–∫–∞ –ø–∞—Å–ø–æ—Ä—Ç–∞
- `GET /api/kyc/passport/status` - —Å—Ç–∞—Ç—É—Å –ø—Ä–æ–≤–µ—Ä–∫–∏
- `POST /api/deals/{id}/sign` - –ø–æ–¥–ø–∏—Å–∞–Ω–∏–µ –¥–æ–≥–æ–≤–æ—Ä–∞
- `POST /api/deals/{id}/payout` - —Å–æ–∑–¥–∞–Ω–∏–µ –≤—ã–ø–ª–∞—Ç—ã
- `GET /api/deals/{id}/legal-package` - –≤—ã–≥—Ä—É–∑–∫–∞ –¥–ª—è —Å—É–¥–∞

#### 3. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ steam_service.py
–ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–≤—ã–π price_aggregator:
```python
prices = await PriceAggregator.get_prices(market_hash_names)
# –í–µ—Ä–Ω—É—Ç—å PriceData —Å –ø–æ–ª—è–º–∏:
# steam_price, lis_price, market_csgo_price, instant_price, is_acceptable
```

### Frontend

#### 1. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞—Ä—Ç–æ—á–µ–∫ –ø—Ä–µ–¥–º–µ—Ç–æ–≤
```tsx
// frontend/src/components/ItemCard.tsx
<div className="item-card">
  <img src={item.icon_url} />
  <h3>{item.name}</h3>
  <div className="prices">
    <div>Steam: {item.steam_price} ‚ÇΩ</div>
    <div>Lis-Skins: {item.lis_price} ‚ÇΩ</div>
    <div>market.csgo: {item.market_csgo_price} ‚ÇΩ</div>
  </div>
  <div className="loan-amount">
    üí∞ –í—ã–¥–∞–¥–∏–º: {item.loan_price} ‚ÇΩ
  </div>
  {!item.is_acceptable && (
    <div className="not-acceptable">
      ‚ùå –ù–µ –ø—Ä–∏–Ω–∏–º–∞–µ–º
      <small>–ù–µ—Ç –º–æ–º–µ–Ω—Ç–∞–ª—å–Ω–æ–π –ø—Ä–æ–¥–∞–∂–∏</small>
    </div>
  )}
</div>
```

#### 2. –°–ª–∞–π–¥–µ—Ä –≤—ã–±–æ—Ä–∞ —Å—Ä–æ–∫–∞
```tsx
// frontend/src/app/cabinet/quote/TermSlider.tsx
<div className="term-slider">
  <label>–°—Ä–æ–∫ –≤—ã–∫—É–ø–∞: {days} –¥–Ω–µ–π</label>
  <input 
    type="range" 
    min={7} 
    max={30} 
    value={days}
    onChange={(e) => setDays(Number(e.target.value))}
  />
  <div className="term-info">
    <div>–í—ã–∫—É–ø –¥–æ: {expiryDate}</div>
    <div>–°—É–º–º–∞ –≤—ã–∫—É–ø–∞: {buybackPrice} ‚ÇΩ</div>
  </div>
</div>
```

#### 3. –ú–∞—Å—Ç–µ—Ä KYC
```tsx
// frontend/src/app/cabinet/kyc/PhoneVerification.tsx
// frontend/src/app/cabinet/kyc/PassportForm.tsx
```

#### 4. –ü–æ–¥–ø–∏—Å—å –¥–æ–≥–æ–≤–æ—Ä–∞
```tsx
// frontend/src/app/cabinet/deal/SignContract.tsx
<div className="contract-sign">
  <iframe src={contractUrl} />
  <label>
    <input type="checkbox" checked={agreed} onChange={...} />
    –°–æ–≥–ª–∞—Å–µ–Ω —Å —É—Å–ª–æ–≤–∏—è–º–∏ –¥–æ–≥–æ–≤–æ—Ä–∞
  </label>
  <button onClick={sendSignatureCode}>
    –ü–æ–¥–ø–∏—Å–∞—Ç—å (–æ—Ç–ø—Ä–∞–≤–∏—Ç—å SMS)
  </button>
  <input 
    type="text" 
    placeholder="–ö–æ–¥ –∏–∑ SMS"
    value={code}
    onChange={...}
  />
  <button onClick={submitSignature}>
    –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –ø–æ–¥–ø–∏—Å—å
  </button>
</div>
```

---

## üìã –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### 1. –û–±–Ω–æ–≤–∏—Ç—å –ë–î –º–æ–¥–µ–ª–∏
```bash
cd backend
# –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ –º–æ–¥–µ–ª–∏ –≤ models.py
# –°–æ–∑–¥–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é
alembic revision --autogenerate -m "Add KYC and audit models"
alembic upgrade head
```

### 2. –û–±–Ω–æ–≤–∏—Ç—å API endpoints
- –î–æ–±–∞–≤–∏—Ç—å –≤—Å–µ –Ω–æ–≤—ã–µ endpoints –≤ main.py
- –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–≤—ã–µ —Å–µ—Ä–≤–∏—Å—ã
- –î–æ–±–∞–≤–∏—Ç—å middleware –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è (IP, user-agent)

### 3. –û–±–Ω–æ–≤–∏—Ç—å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥
- –°–æ–∑–¥–∞—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –¥–ª—è KYC
- –î–æ–±–∞–≤–∏—Ç—å —Å–ª–∞–π–¥–µ—Ä —Å—Ä–æ–∫–∞
- –û–±–Ω–æ–≤–∏—Ç—å –∫–∞—Ä—Ç–æ—á–∫–∏ –ø—Ä–µ–¥–º–µ—Ç–æ–≤
- –°–æ–∑–¥–∞—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø–æ–¥–ø–∏—Å–∏ –¥–æ–≥–æ–≤–æ—Ä–∞

### 4. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- Unit-—Ç–µ—Å—Ç—ã –¥–ª—è –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã API
- E2E —Ç–µ—Å—Ç—ã –ø–æ–ª–Ω–æ–≥–æ —Ñ–ª–æ—É

### 5. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
–û–±–Ω–æ–≤–∏—Ç—å `.env`:
```env
# SMS
SMS_PROVIDER=fake  # –∏–ª–∏ sms.ru
SMS_API_KEY=

# KYC
KYC_PROVIDER=fake  # –∏–ª–∏ sumsub
KYC_API_KEY=

# –°–ë–ü
SBP_PROVIDER=fake  # –∏–ª–∏ modulbank
SBP_API_KEY=

# Lis-Skins
LIS_SKINS_API_KEY=

# market.csgo
MARKET_CSGO_API_KEY=
```

---

## üéØ –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ production

### –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å–µ–π—á–∞—Å:
- ‚úÖ –ë–∞–∑–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–µ—Ä–≤–∏—Å–æ–≤
- ‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
- ‚úÖ –õ–æ–≥–∏–∫–∞ —Ä–∞—Å—á—ë—Ç–æ–≤
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ (—Å fake –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞–º–∏)

### –ß—Ç–æ –Ω—É–∂–Ω–æ –¥–ª—è –∑–∞–ø—É—Å–∫–∞:
1. –û–±–Ω–æ–≤–∏—Ç—å models.py –∏ —Å–¥–µ–ª–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é
2. –î–æ–±–∞–≤–∏—Ç—å endpoints –≤ main.py
3. –°–æ–∑–¥–∞—Ç—å UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
4. –ü–æ–ª—É—á–∏—Ç—å API –∫–ª—é—á–∏ –æ—Ç –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤
5. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª–Ω—ã–π —Ñ–ª–æ—É

### –û—Ü–µ–Ω–∫–∞ –≤—Ä–µ–º–µ–Ω–∏:
- Backend (models + endpoints): 4-6 —á–∞—Å–æ–≤
- Frontend (UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã): 6-8 —á–∞—Å–æ–≤
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ: 4-6 —á–∞—Å–æ–≤
- **–ò—Ç–æ–≥–æ: 14-20 —á–∞—Å–æ–≤ –¥–æ –ø–æ–ª–Ω–æ–π –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏**

---

## üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

### Fake –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã
–í—Å–µ —Å–µ—Ä–≤–∏—Å—ã –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç fake —Ä–µ–∂–∏–º –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏:
- SMS –∫–æ–¥—ã –≤—ã–≤–æ–¥—è—Ç—Å—è –≤ –∫–æ–Ω—Å–æ–ª—å
- KYC –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–¥–æ–±—Ä—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã
- –°–ë–ü –≤—ã–ø–ª–∞—Ç—ã –º–≥–Ω–æ–≤–µ–Ω–Ω–æ "—É—Å–ø–µ—à–Ω—ã"

### –†–µ–∞–ª—å–Ω—ã–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
–î–ª—è production –Ω—É–∂–Ω–æ:
1. –ü–æ–ª—É—á–∏—Ç—å API –∫–ª—é—á–∏
2. –ò–∑–º–µ–Ω–∏—Ç—å –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤ –≤ .env
3. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- –í—Å–µ –∫–æ–¥—ã —Ö–µ—à–∏—Ä—É—é—Ç—Å—è (SHA-256)
- –¢–µ–ª–µ—Ñ–æ–Ω—ã –∏ IP –º–∞—Å–∫–∏—Ä—É—é—Ç—Å—è –≤ –¥–æ–≥–æ–≤–æ—Ä–∞—Ö
- –ü–æ–ª–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è —Å—É–¥–∞
- –•–µ—à –¥–æ–≥–æ–≤–æ—Ä–∞ –¥–ª—è –Ω–µ–∏–∑–º–µ–Ω—è–µ–º–æ—Å—Ç–∏
